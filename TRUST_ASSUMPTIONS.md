# SafeLens Trust Assumptions

This document lists every trust assumption SafeLens makes today.

SafeLens classifies each source as:

- `self-verified`: validated locally with deterministic code
- `api-sourced`: accepted from remote API responses
- `user-provided`: accepted from local operator input or local files

## Evidence Generation (`apps/generator`, CLI `analyze`)

| Source | Trust | Assumption | Mitigation |
|---|---|---|---|
| Safe URL input | user-provided | Operator pasted the intended Safe URL and safeTxHash | Review URL before generating evidence |
| Safe Transaction Service response | api-sourced | Safe API returned correct payload for safeTxHash | Re-verify package offline and compare with independent tooling if required |
| `packagedAt` timestamp | user-provided | Generator host clock is accurate | Use controlled system clock on generator machine |
| Exported `evidence.json` | self-verified | Local runtime writes generated bytes faithfully | Hash/sign exported artifact in your own pipeline if needed |

## Evidence Verification (`apps/desktop`, CLI `verify`)

| Source | Trust | Assumption | Mitigation |
|---|---|---|---|
| Evidence package integrity | self-verified | JSON/schema parser and runtime are trustworthy | Keep binaries reproducible and verified |
| Safe tx hash recomputation | self-verified | Local hash implementation is correct | Cross-check hashes with independent implementation for critical flows |
| Signature recovery checks | self-verified | Signatures are matched to claimed owners for `safeTxHash` | Treat invalid/unsupported signatures as hard stop |
| Signature scheme coverage | api-sourced when unsupported signatures exist | Contract signatures / pre-approved hashes are not fully verified locally | Use on-chain or Safe-native validation when unsupported signatures appear |
| Safe owners and threshold | api-sourced | `confirmations` and `confirmationsRequired` in evidence reflect on-chain state | Compare against chain state at execution block for high-assurance workflows |
| Decoded calldata metadata | api-sourced | Human-readable decode (`dataDecoded`) may be incorrect | Treat raw calldata + hash as canonical; decode independently when needed |
| Local settings labels | user-provided | Address/contract labels are accurate | Keep settings under change control and review diffs |

## Desktop Airgap Scope

SafeLens desktop is intended to run in a fully airgapped environment after install:

- Production CSP sets `connect-src 'none'`.
- No `shell-open` capability is enabled in Tauri allowlist or Rust features.
- Desktop frontend source contains no network API calls.

These are enforced by automated tests in `apps/desktop/tests/airgap-config.test.ts`.
